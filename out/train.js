"use strict";
var App;
(function (App) {
    App.training = false;
    App.trained = App.initData !== null;
    function train(onGenerating, onTraining, onFinished) {
        App.training = true;
        const trainingSets = [];
        let i = 0;
        const interval = setInterval(() => {
            if (i === App.chars.length) {
                clearInterval(interval);
                const listener = ({ data }) => {
                    switch (data.type) {
                        case 'training':
                            onTraining(data.char, data.current, App.chars.length);
                            break;
                        case 'trainFinished':
                            onFinished();
                            App.worker.removeEventListener('message', listener);
                            App.training = false;
                            App.trained = true;
                            AppStorage.savePerceptronData(data.newData);
                            break;
                    }
                };
                App.worker.addEventListener('message', listener);
                App.worker.postMessage({
                    type: 'train',
                    trainingSets
                }, [].concat(...trainingSets));
                return;
            }
            onGenerating(App.chars[i], i + 1, App.chars.length);
            trainingSets.push(Array.from({ length: App.trainingCopies }, (_, j) => {
                App.inputArea.renderChar(App.chars[i]);
                if (j !== 0) {
                    App.inputArea.addNoise();
                }
                return App.inputArea.getBuffer();
            }));
            i++;
        });
    }
    App.train = train;
})(App || (App = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhaW4uanMiLCJzb3VyY2VSb290IjoiZDovU3R1ZGVudF9EYXRhL0dpdGh1Yi9jaGFyYWN0ZXItcmVjb2duaXRpb24vc3JjLyIsInNvdXJjZXMiOlsidHJhaW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQVUsR0FBRyxDQWtEWjtBQWxERCxXQUFVLEdBQUc7SUFFRSxZQUFRLEdBQUcsS0FBSyxDQUFDO0lBQ2pCLFdBQU8sR0FBRyxJQUFBLFFBQVEsS0FBSyxJQUFJLENBQUM7SUFFdkMsZUFDSSxZQUFtRSxFQUNuRSxVQUFpRSxFQUNqRSxVQUFxQjtRQUVyQixJQUFBLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDaEIsTUFBTSxZQUFZLEdBQUcsRUFBcUIsQ0FBQztRQUMzQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDVixNQUFNLFFBQVEsR0FBRyxXQUFXLENBQUM7WUFDekIsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUEsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQ3JCLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDeEIsTUFBTSxRQUFRLEdBQ1YsQ0FBQyxFQUFFLElBQUksRUFBMkI7b0JBQzlCLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO3dCQUNoQixLQUFLLFVBQVU7NEJBQ1gsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFBLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQzs0QkFDbEQsS0FBSyxDQUFDO3dCQUNWLEtBQUssZUFBZTs0QkFDaEIsVUFBVSxFQUFFLENBQUM7NEJBQ2IsSUFBQSxNQUFNLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDOzRCQUNoRCxJQUFBLFFBQVEsR0FBRyxLQUFLLENBQUM7NEJBQ2pCLElBQUEsT0FBTyxHQUFHLElBQUksQ0FBQzs0QkFDZixVQUFVLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDOzRCQUM1QyxLQUFLLENBQUM7b0JBQ2QsQ0FBQztnQkFDTCxDQUFDLENBQUM7Z0JBQ04sSUFBQSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDO2dCQUM3QyxJQUFBLE1BQU0sQ0FBQyxXQUFXLENBQUM7b0JBQ2YsSUFBSSxFQUFFLE9BQU87b0JBQ2IsWUFBWTtpQkFDQSxFQUFHLEVBQW9CLENBQUMsTUFBTSxDQUFDLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQztnQkFDakUsTUFBTSxDQUFDO1lBQ1gsQ0FBQztZQUNELFlBQVksQ0FBQyxJQUFBLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUEsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzVDLFlBQVksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFBLGNBQWMsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7Z0JBQzFELElBQUEsU0FBUyxDQUFDLFVBQVUsQ0FBQyxJQUFBLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMvQixFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDVixJQUFBLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDekIsQ0FBQztnQkFDRCxNQUFNLENBQUMsSUFBQSxTQUFTLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDakMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNKLENBQUMsRUFBRSxDQUFDO1FBQ1IsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBM0NlLFNBQUssUUEyQ3BCLENBQUE7QUFFTCxDQUFDLEVBbERTLEdBQUcsS0FBSCxHQUFHLFFBa0RaIiwic291cmNlc0NvbnRlbnQiOlsibmFtZXNwYWNlIEFwcCB7XHJcblxyXG4gICAgZXhwb3J0IGxldCB0cmFpbmluZyA9IGZhbHNlO1xyXG4gICAgZXhwb3J0IGxldCB0cmFpbmVkID0gaW5pdERhdGEgIT09IG51bGw7XHJcblxyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIHRyYWluKFxyXG4gICAgICAgIG9uR2VuZXJhdGluZzogKGNoYXI6IHN0cmluZywgY3VycmVudDogbnVtYmVyLCB0b3RhbDogbnVtYmVyKSA9PiBhbnksXHJcbiAgICAgICAgb25UcmFpbmluZzogKGNoYXI6IHN0cmluZywgY3VycmVudDogbnVtYmVyLCB0b3RhbDogbnVtYmVyKSA9PiBhbnksXHJcbiAgICAgICAgb25GaW5pc2hlZDogKCkgPT4gYW55XHJcbiAgICApIHtcclxuICAgICAgICB0cmFpbmluZyA9IHRydWU7XHJcbiAgICAgICAgY29uc3QgdHJhaW5pbmdTZXRzID0gW10gYXMgQXJyYXlCdWZmZXJbXVtdO1xyXG4gICAgICAgIGxldCBpID0gMDtcclxuICAgICAgICBjb25zdCBpbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKGkgPT09IGNoYXJzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsaXN0ZW5lcjogKGV2ZW50OiBNZXNzYWdlRXZlbnQpID0+IHZvaWQgPVxyXG4gICAgICAgICAgICAgICAgICAgICh7IGRhdGEgfTogeyBkYXRhOiBXb3JrZXJNZXNzYWdlIH0pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChkYXRhLnR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3RyYWluaW5nJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblRyYWluaW5nKGRhdGEuY2hhciwgZGF0YS5jdXJyZW50LCBjaGFycy5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAndHJhaW5GaW5pc2hlZCc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25GaW5pc2hlZCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmtlci5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgbGlzdGVuZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWluaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhaW5lZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXBwU3RvcmFnZS5zYXZlUGVyY2VwdHJvbkRhdGEoZGF0YS5uZXdEYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICB3b3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGxpc3RlbmVyKTtcclxuICAgICAgICAgICAgICAgIHdvcmtlci5wb3N0TWVzc2FnZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RyYWluJyxcclxuICAgICAgICAgICAgICAgICAgICB0cmFpbmluZ1NldHNcclxuICAgICAgICAgICAgICAgIH0gYXMgTWFpbk1lc3NhZ2UsIChbXSBhcyBBcnJheUJ1ZmZlcltdKS5jb25jYXQoLi4udHJhaW5pbmdTZXRzKSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb25HZW5lcmF0aW5nKGNoYXJzW2ldLCBpICsgMSwgY2hhcnMubGVuZ3RoKTtcclxuICAgICAgICAgICAgdHJhaW5pbmdTZXRzLnB1c2goQXJyYXkuZnJvbSh7IGxlbmd0aDogdHJhaW5pbmdDb3BpZXMgfSwgKF8sIGopID0+IHtcclxuICAgICAgICAgICAgICAgIGlucHV0QXJlYS5yZW5kZXJDaGFyKGNoYXJzW2ldKTtcclxuICAgICAgICAgICAgICAgIGlmIChqICE9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5wdXRBcmVhLmFkZE5vaXNlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5wdXRBcmVhLmdldEJ1ZmZlcigpO1xyXG4gICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgIGkrKztcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG59XHJcbiJdfQ==