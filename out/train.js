"use strict";
var App;
(function (App) {
    App.training = false;
    function train(onGenerating, onTraining, onFinished) {
        App.training = true;
        const trainingSets = [];
        let i = 0;
        const interval = setInterval(() => {
            if (i === App.chars.length) {
                clearInterval(interval);
                const listener = ({ data }) => {
                    switch (data.type) {
                        case 'training':
                            onTraining(data.char, data.current, App.chars.length);
                            break;
                        case 'trainFinished':
                            onFinished();
                            App.worker.removeEventListener('message', listener);
                            App.training = false;
                            break;
                    }
                };
                App.worker.addEventListener('message', listener);
                App.worker.postMessage({
                    type: 'train',
                    trainingSets
                }, [].concat(...trainingSets));
                return;
            }
            onGenerating(App.chars[i], i + 1, App.chars.length);
            trainingSets.push(Array.from({ length: App.trainingCopies }, (_, j) => {
                App.inputArea.renderChar(App.chars[i]);
                if (j !== 0) {
                    App.inputArea.addNoise();
                }
                return App.inputArea.getBuffer();
            }));
            i++;
        });
    }
    App.train = train;
})(App || (App = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhaW4uanMiLCJzb3VyY2VSb290IjoiZDovU3R1ZGVudF9EYXRhL0dpdGh1Yi9jaGFyYWN0ZXItcmVjb2duaXRpb24vc3JjLyIsInNvdXJjZXMiOlsidHJhaW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLElBQVUsR0FBRyxDQStDWjtBQS9DRCxXQUFVLEdBQUc7SUFFRSxZQUFRLEdBQUcsS0FBSyxDQUFDO0lBRTVCLGVBQ0ksWUFBbUUsRUFDbkUsVUFBaUUsRUFDakUsVUFBcUI7UUFFckIsSUFBQSxRQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLE1BQU0sWUFBWSxHQUFHLEVBQXFCLENBQUM7UUFDM0MsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1YsTUFBTSxRQUFRLEdBQUcsV0FBVyxDQUFDO1lBQ3pCLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFBLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ3hCLE1BQU0sUUFBUSxHQUNWLENBQUMsRUFBRSxJQUFJLEVBQTJCO29CQUM5QixNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQzt3QkFDaEIsS0FBSyxVQUFVOzRCQUNYLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBQSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7NEJBQ2xELEtBQUssQ0FBQzt3QkFDVixLQUFLLGVBQWU7NEJBQ2hCLFVBQVUsRUFBRSxDQUFDOzRCQUNiLElBQUEsTUFBTSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsRUFBRSxRQUFRLENBQUMsQ0FBQzs0QkFDaEQsSUFBQSxRQUFRLEdBQUcsS0FBSyxDQUFDOzRCQUNqQixLQUFLLENBQUM7b0JBQ2QsQ0FBQztnQkFDTCxDQUFDLENBQUM7Z0JBQ04sSUFBQSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDO2dCQUM3QyxJQUFBLE1BQU0sQ0FBQyxXQUFXLENBQUM7b0JBQ2YsSUFBSSxFQUFFLE9BQU87b0JBQ2IsWUFBWTtpQkFDQSxFQUFHLEVBQW9CLENBQUMsTUFBTSxDQUFDLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQztnQkFDakUsTUFBTSxDQUFDO1lBQ1gsQ0FBQztZQUNELFlBQVksQ0FBQyxJQUFBLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUEsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzVDLFlBQVksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFBLGNBQWMsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUM7Z0JBQzFELElBQUEsU0FBUyxDQUFDLFVBQVUsQ0FBQyxJQUFBLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMvQixFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDVixJQUFBLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDekIsQ0FBQztnQkFDRCxNQUFNLENBQUMsSUFBQSxTQUFTLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDakMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNKLENBQUMsRUFBRSxDQUFDO1FBQ1IsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBekNlLFNBQUssUUF5Q3BCLENBQUE7QUFFTCxDQUFDLEVBL0NTLEdBQUcsS0FBSCxHQUFHLFFBK0NaIiwic291cmNlc0NvbnRlbnQiOlsibmFtZXNwYWNlIEFwcCB7XHJcblxyXG4gICAgZXhwb3J0IGxldCB0cmFpbmluZyA9IGZhbHNlO1xyXG5cclxuICAgIGV4cG9ydCBmdW5jdGlvbiB0cmFpbihcclxuICAgICAgICBvbkdlbmVyYXRpbmc6IChjaGFyOiBzdHJpbmcsIGN1cnJlbnQ6IG51bWJlciwgdG90YWw6IG51bWJlcikgPT4gYW55LFxyXG4gICAgICAgIG9uVHJhaW5pbmc6IChjaGFyOiBzdHJpbmcsIGN1cnJlbnQ6IG51bWJlciwgdG90YWw6IG51bWJlcikgPT4gYW55LFxyXG4gICAgICAgIG9uRmluaXNoZWQ6ICgpID0+IGFueVxyXG4gICAgKSB7XHJcbiAgICAgICAgdHJhaW5pbmcgPSB0cnVlO1xyXG4gICAgICAgIGNvbnN0IHRyYWluaW5nU2V0cyA9IFtdIGFzIEFycmF5QnVmZmVyW11bXTtcclxuICAgICAgICBsZXQgaSA9IDA7XHJcbiAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChpID09PSBjaGFycy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbGlzdGVuZXI6IChldmVudDogTWVzc2FnZUV2ZW50KSA9PiB2b2lkID1cclxuICAgICAgICAgICAgICAgICAgICAoeyBkYXRhIH06IHsgZGF0YTogV29ya2VyTWVzc2FnZSB9KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoZGF0YS50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICd0cmFpbmluZyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25UcmFpbmluZyhkYXRhLmNoYXIsIGRhdGEuY3VycmVudCwgY2hhcnMubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3RyYWluRmluaXNoZWQnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uRmluaXNoZWQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JrZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGxpc3RlbmVyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFpbmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIHdvcmtlci5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgbGlzdGVuZXIpO1xyXG4gICAgICAgICAgICAgICAgd29ya2VyLnBvc3RNZXNzYWdlKHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAndHJhaW4nLFxyXG4gICAgICAgICAgICAgICAgICAgIHRyYWluaW5nU2V0c1xyXG4gICAgICAgICAgICAgICAgfSBhcyBNYWluTWVzc2FnZSwgKFtdIGFzIEFycmF5QnVmZmVyW10pLmNvbmNhdCguLi50cmFpbmluZ1NldHMpKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvbkdlbmVyYXRpbmcoY2hhcnNbaV0sIGkgKyAxLCBjaGFycy5sZW5ndGgpO1xyXG4gICAgICAgICAgICB0cmFpbmluZ1NldHMucHVzaChBcnJheS5mcm9tKHsgbGVuZ3RoOiB0cmFpbmluZ0NvcGllcyB9LCAoXywgaikgPT4ge1xyXG4gICAgICAgICAgICAgICAgaW5wdXRBcmVhLnJlbmRlckNoYXIoY2hhcnNbaV0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGogIT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnB1dEFyZWEuYWRkTm9pc2UoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBpbnB1dEFyZWEuZ2V0QnVmZmVyKCk7XHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgaSsrO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgXHJcbn1cclxuIl19